<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insert sample results data • rodm2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Insert sample results data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rodm2</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Insert-sample-results-data.html">Insert sample results data</a>
    </li>
    <li>
      <a href="../articles/insert-measurements.html">Insert measurement results</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Insert time series results</a>
    </li>
    <li>
      <a href="../articles/new_person.html">Link Actions to People</a>
    </li>
    <li>
      <a href="../articles/newsites.html">Add new sites</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Insert sample results data</h1>
            
      
      
      <div class="hidden name"><code>Insert-sample-results-data.Rmd</code></div>

    </div>

    
    
<p>Sample results are measurement results (i.e., numeric) associated with an ex-situ procedure performed on a physical specimen collected at a site in the field. This is represented in the datbase as:</p>
<ul>
<li>a <strong>sample collection action</strong>, specifying how (method) and when (Timestamp) the sample (sample code) was taken. For example, “Sample 001 collected on 2018-02-05 13:00:00 using the 1 inch 30 cm soil core method.”</li>
<li>Where the sample was collected is recorded using the “was collected at” relationship type: “Sample 001 was collected at Site A”.</li>
<li>A <strong>sample analysis action</strong>, specifying how and when the results were produced, i.e. how and when the sample was analyzed in the lab.</li>
</ul>
<p>Results are associated with the “feature action” of analyzing the sample. Multiple variables can be associated with the same procedure in the lab, such as multiple peak values from the GC. Each variable is described as a separate result with its own units and missing data value.</p>
<div id="prepare-data" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-data" class="anchor"></a>Prepare data</h1>
<p>Dataset to upload must have columns for:</p>
<ul>
<li>Timestamp formatted as: YYYY-MM-DD HH:MM:SS</li>
<li>Site</li>
<li>Sample</li>
<li>One column for each variable.</li>
</ul>
<p>Timestamp will be used for the time the sample was collected. If you want to specify the time the sample was analyzed in the lab, use a column named “Timestamp_analysis” (otherwise this defaults to the current time). Make sure the time is formatted as YYYY-MM-DD HH:MM:SS. If you need to specify a time zone other than the current one, use a POSIXct data type with the correct time zone specified. To convert from any other (non-ambiguous) date format, you can use the <code>strptime()</code> functon.</p>
<p>Example input data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">soil_ph &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">Timestamp =</span> <span class="st">"2018-02-05 23:59:59"</span>,
  <span class="dt">Site =</span> <span class="st">"QB SC-A"</span>,
  <span class="dt">Sample =</span> <span class="st">"CEM 2"</span>,
  <span class="dt">pH =</span> <span class="fl">4.5</span>,
  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)
<span class="kw">head</span>(soil_ph)
<span class="co">#&gt;             Timestamp    Site Sample  pH</span>
<span class="co">#&gt; 1 2018-02-05 23:59:59 QB SC-A  CEM 2 4.5</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Timestamp</th>
<th align="left">Site</th>
<th align="left">Sample</th>
<th align="right">pH</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">2018-02-05 23:59:59</td>
<td align="left">QB SC-A</td>
<td align="left">CEM 2</td>
<td align="right">4.5</td>
</tr></tbody>
</table>
<div id="variables-and-units" class="section level2">
<h2 class="hasAnchor">
<a href="#variables-and-units" class="anchor"></a>Variables and units</h2>
<p>Metadata about variables needs to be stored in a list with the format:</p>
<pre><code>list("Variable1 Name" = list(column = "ColumnName", units = "Units Name"),
     "Variable2 Name" = list(column = "ColumnName", units = "Units Name"))</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars_list =<span class="st"> </span><span class="kw">list</span>(<span class="st">"pH"</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">units =</span> <span class="st">"pH"</span>))</code></pre></div>
<p>If the column name is the exact name of the variable from the controlled vocabulary (i.e. with spaces and correct capitalization), column does not need to be specified. If there are columns in your data that have data quality codes or censor codes, those should be specified here as qualitycodecol and censorcodecol respectively. You can also specify a variabletypecv, variabledefinition and nodatavalue for variables that haven’t been entered to the database before.</p>
<p>Variable names and units names need to be from the controlled vocabularies. To see these options, use the <code><a href="../reference/get_cv_terms.html">get_cv_terms()</a></code> function (requires having the <code>rodm2</code> package loaded, see below).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_cv_terms.html">get_cv_terms</a></span>(<span class="st">"variablename"</span>)
<span class="kw"><a href="../reference/get_cv_terms.html">get_cv_terms</a></span>(<span class="st">"units"</span>)</code></pre></div>
</div>
<div id="connect" class="section level2">
<h2 class="hasAnchor">
<a href="#connect" class="anchor"></a>Connect</h2>
<p>Load rodm2 and create a connection to your database. If you don’t have an existing database, create an empty ODM2 sqlite database using <code><a href="../reference/create_sqlite.html">create_sqlite(connect = TRUE)</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"khondula/rodm2"</span>)
<span class="kw">library</span>(rodm2)
db &lt;-<span class="st"> </span>rodm2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rodm2/topics/create_sqlite">create_sqlite</a></span>(<span class="dt">connect =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>
<div id="insert" class="section level1">
<h1 class="hasAnchor">
<a href="#insert" class="anchor"></a>Insert</h1>
<p>Use the <code><a href="../reference/db_insert_results_samples.html">db_insert_results_samples()</a></code> function from the rodm2 package. You must supply the database connection, data frame, variables list, code names for the methods used in the field and lab, and the sampled medium from the controlled vocabulary (e.g. Air, Soil, etc.). Sampled medium choices can be viewed using <code><a href="../reference/get_cv_terms.html">get_cv_terms("medium")</a></code>. If the variable(s), method, or site code do not already exist in the database, they will be added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/db_insert_results_samples.html">db_insert_results_samples</a></span>(<span class="dt">db =</span> db,
                          <span class="dt">datavalues =</span> soil_ph,
                          <span class="dt">field_method =</span> <span class="st">"1 inch 30 cm soil core"</span>,
                          <span class="dt">lab_method =</span> <span class="st">"soil pH CEM"</span>,
                          <span class="dt">variables =</span> vars_list,
                          <span class="dt">sampledmedium =</span> <span class="st">"Soil"</span>)
<span class="co">#&gt; 1 inch 30 cm soil core has been added to the Methods table.</span>
<span class="co">#&gt; soil pH CEM has been added to the Methods table.</span>
<span class="co">#&gt; Site QB SC-A has been entered into the samplingfeatures table.</span>
<span class="co">#&gt; Raw data has been inserted into the processinglevel table.</span>
<span class="co">#&gt; pH has been added to the Variables table.</span>
<span class="co">#&gt; Sample  CEM 2 and associated data have been entered.</span></code></pre></div>
<p><strong>Arguments with defaults</strong></p>
<p>Use these arguments if needed to change defaults:</p>
<ul>
<li>site_code_col = “Site”</li>
<li>sample_code_col = “Sample”</li>
<li>processinglevel = “Raw data”</li>
<li>aggregationstatistic = “Unknown”</li>
<li>time_aggregation_interval = list(1, “Minute”)</li>
</ul>
<p><strong>Optional arguments</strong></p>
<ul>
<li>field_actionby: specify who led the field action</li>
<li>lab_actionby: specify who led the lab action</li>
<li>field_equipment_name: specify the name of the equipment used in the field</li>
<li>lab_equipment_name: specify the name of equipment used in the lab</li>
<li>zlocation: specify a vertical offset from the site location to associate with the results</li>
<li>zlocationunits: specify the units of the vertical offset</li>
</ul>
<blockquote>
<p>Note: field_actionby &amp; lab_actionby must be people who are already in the database (can be added using the <code><a href="../reference/db_describe_person.html">db_describe_person()</a></code> function). Similarly, field_equipment_name &amp; lab_equipment_name must be equipment already in the database (can be added using the <code><a href="../reference/db_describe_equipment.html">db_describe_equipment()</a></code> function).</p>
</blockquote>
<blockquote>
<p>What about time zone?</p>
</blockquote>
<p>The values in the “Timestamp” column must have time in the format YYYY-MM-DD HH:MM:SS, but they can be character data or POSIXct. If they are character data, the time zone will be your computer’s local time, i.e. whatever is returned from <code>Sys.time()</code>. To specify a different time zone, such as if you are uploading data that was collected before or after daylight savings time or you are using UTC, make sure that the dates in the Timestamp column are of POSIXct format with a timezone specified. You can check the timezone of an object using the function <code><a href="http://lubridate.tidyverse.org/reference/tz.html">lubridate::tz()</a></code>. In the database, datetime values are stored in one column and timezones are stored in a separate column (as “UTC offset”). In the upload function, the UTC offset is an intger determined by using <code>format(as.POSIXct(x), "%z")</code>.</p>
<div id="get-values" class="section level2">
<h2 class="hasAnchor">
<a href="#get-values" class="anchor"></a>Get values</h2>
<p>One way to query your database is using an SQL code chunk:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> datavalue, res.resultid, var.variablenamecv, units.unitsname, valuedatetime, sf.samplingfeaturecode, meth.methodcode
<span class="kw">FROM</span> measurementresultvalues mrv
<span class="kw">INNER</span> <span class="kw">JOIN</span> results res <span class="kw">ON</span> mrv.resultid = res.resultid
<span class="kw">INNER</span> <span class="kw">JOIN</span> variables var <span class="kw">ON</span> res.variableid = var.variableid
<span class="kw">INNER</span> <span class="kw">JOIN</span> featureactions fa <span class="kw">ON</span> res.featureactionid = fa.featureactionid
<span class="kw">INNER</span> <span class="kw">JOIN</span> samplingfeatures sf <span class="kw">ON</span> sf.samplingfeatureid = fa.samplingfeatureid
<span class="kw">INNER</span> <span class="kw">JOIN</span> actions acts <span class="kw">ON</span> acts.actionid = fa.actionid
<span class="kw">INNER</span> <span class="kw">JOIN</span> units units <span class="kw">ON</span> units.unitsid = res.unitsid
<span class="kw">INNER</span> <span class="kw">JOIN</span> methods meth <span class="kw">ON</span> meth.methodid = acts.methodid</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">DataValue</th>
<th align="right">ResultID</th>
<th align="left">VariableNameCV</th>
<th align="left">UnitsName</th>
<th align="left">ValueDateTime</th>
<th align="left">SamplingFeatureCode</th>
<th align="left">MethodCode</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">4.5</td>
<td align="right">1</td>
<td align="left">pH</td>
<td align="left">pH</td>
<td align="left">2018-02-05 23:59:59</td>
<td align="left">CEM 2</td>
<td align="left">soil pH CEM</td>
</tr></tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#prepare-data">Prepare data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#variables-and-units">Variables and units</a></li>
      <li><a href="#connect">Connect</a></li>
      </ul>
</li>
      <li>
<a href="#insert">Insert</a><ul class="nav nav-pills nav-stacked">
<li><a href="#get-values">Get values</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kelly Hondula.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
