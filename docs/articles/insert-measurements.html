<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Insert measurement results • rodm2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Insert measurement results">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rodm2</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rodm2.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Insert-sample-results-data.html">Insert sample results data</a>
    </li>
    <li>
      <a href="../articles/insert-measurements.html">Insert measurement results</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Insert time series results</a>
    </li>
    <li>
      <a href="../articles/new_person.html">Link Actions to People</a>
    </li>
    <li>
      <a href="../articles/newsites.html">Add new sites</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/khondula/rodm2">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Insert measurement results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/khondula/rodm2/blob/master/vignettes/insert-measurements.Rmd"><code>vignettes/insert-measurements.Rmd</code></a></small>
      <div class="hidden name"><code>insert-measurements.Rmd</code></div>

    </div>

    
    
<p>Measurement results are one value per variable collected at one site using a specific method. This example shows how to upload data from a dataframe where each row is point data about a set variables collected at a site. The data are associated with one “action” because the same instrument measured all 3 variables. Each variable’s data is a different “result” with different units.</p>
<div id="connect" class="section level2">
<h2 class="hasAnchor">
<a href="#connect" class="anchor"></a>Connect</h2>
<p>Load rodm2 and create a connection to your database. If you don’t have an existing database, create an empty ODM2 sqlite database using <code><a href="../reference/create_sqlite.html">create_sqlite(connect = TRUE)</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rodm2)
db &lt;-<span class="st"> </span>rodm2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rodm2/topics/create_sqlite">create_sqlite</a></span>(<span class="dt">connect =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="prepare-data" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-data" class="anchor"></a>Prepare data</h2>
<p>The data to upload should have data for one or more variables, where data in each row was collected at one site using the same instrument. It needs a “Timestamp column” formatted as YYYY-MM-DD HH:MM:SS, and a column with site codes. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">measurement_data &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="dt">Timestamp =</span> <span class="kw">c</span>(<span class="st">"2018-06-27 13:45:00"</span>, <span class="st">"2018-06-27 13:55:00"</span>),
                   <span class="st">"wd"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">180</span>,<span class="dv">170</span>),
                   <span class="st">"ws"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>), 
                   <span class="st">"gustspeed"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">2.5</span>),
                   <span class="st">"site"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">"BB1"</span>, <span class="st">"BB2"</span>))
<span class="kw">head</span>(measurement_data)
<span class="co">#&gt; # A tibble: 2 x 5</span>
<span class="co">#&gt;   Timestamp              wd    ws gustspeed site </span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;</span>
<span class="co">#&gt; 1 2018-06-27 13:45:00   180   1         2   BB1  </span>
<span class="co">#&gt; 2 2018-06-27 13:55:00   170   1.5       2.5 BB2</span></code></pre></div>
</div>
<div id="variables-and-units" class="section level2">
<h2 class="hasAnchor">
<a href="#variables-and-units" class="anchor"></a>Variables and units</h2>
<p>A list that matches the variables (i.e. column names) to their units id required. Make sure the units are selected from existing unit names in the units table. (A new database created with <code><a href="../reference/create_sqlite.html">create_sqlite()</a></code> comes populated with 1203 units that can be accessed with <code><a href="../reference/get_cv_terms.html">get_cv_terms("units")</a></code>.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="st">'Wind direction'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'wd'</span>, <span class="dt">units =</span> <span class="st">'Degree'</span>),
  <span class="st">'Wind speed'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'ws'</span>, <span class="dt">units =</span> <span class="st">'Meter per Second'</span>),
  <span class="st">'Wind gust speed'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'gustspeed'</span>, <span class="dt">units =</span> <span class="st">'Meter per Second'</span>)
)</code></pre></div>
<p>To see a list of any controlled vocabulary terms, use the <code><a href="../reference/get_cv_terms.html">get_cv_terms()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">varnames &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_cv_terms.html">get_cv_terms</a></span>(<span class="st">"variablename"</span>) 
<span class="co">#&gt; use quietly = FALSE to print out all controlled vocabulary terms</span>
<span class="kw">grep</span>(<span class="st">"Wind"</span>, varnames, <span class="dt">value =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] "Wind Run"            "Wind chill"          "Wind direction"     </span>
<span class="co">#&gt; [4] "Wind gust direction" "Wind gust speed"     "Wind speed"         </span>
<span class="co">#&gt; [7] "Wind stress"</span></code></pre></div>
<blockquote>
<p>What about time zone?</p>
</blockquote>
<p>The values in the “Timestamp” column must have time in the format YYYY-MM-DD HH:MM:SS, but they can be character data or POSIXct. If they are character data, the time zone will be your computer’s local time, i.e. whatever is returned from <code>Sys.time()</code>. To specify a different time zone, such as if you are uploading data that was collected before or after daylight savings time or you are using UTC, make sure that the dates in the Timestamp column are of POSIXct format with a timezone specified. You can check the timezone of an object using the function <code><a href="http://lubridate.tidyverse.org/reference/tz.html">lubridate::tz()</a></code>. In the database, datetime values are stored in one column and timezones are stored in a separate column (as “UTC offset”). In the upload function, the UTC offset is an intger determined by using <code>format(as.POSIXct(x), "%z")</code>.</p>
</div>
<div id="insert" class="section level2">
<h2 class="hasAnchor">
<a href="#insert" class="anchor"></a>Insert</h2>
<p>The required arguments to <code><a href="../reference/db_insert_results_m.html">db_insert_results_m()</a></code> are</p>
<ul>
<li>database connection</li>
<li>data frame with Timestamp, site, and [Variable Name] columns</li>
<li>list of (“variables” = “units”) for each variable to be uploaded</li>
<li>method code</li>
<li>name of column with site codes</li>
<li>sampled medium (from medium controlled vocabulary e.g. Air, Soil, etc.)</li>
</ul>
<p>If the variable(s), method, or site code do not already exist in the database, they will be added.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/db_insert_results_m.html">db_insert_results_m</a></span>(<span class="dt">db =</span> db, 
                     <span class="dt">datavalues =</span> measurement_data,
                     <span class="dt">variables =</span> vars_list,
                    <span class="dt">site_code_col =</span> <span class="st">"site"</span>,
                     <span class="dt">method =</span> <span class="st">"SonicAnemometer"</span>,
                     <span class="dt">site_code =</span> <span class="st">"BB2"</span>,
                     <span class="dt">sampledmedium =</span> <span class="st">"Air"</span>)
<span class="co">#&gt; SonicAnemometer has been added to the Methods table.</span>
<span class="co">#&gt; Site BB1 has been entered into the samplingfeatures table.</span>
<span class="co">#&gt; Site BB2 has been entered into the samplingfeatures table.</span>
<span class="co">#&gt; Wind direction has been added to the Variables table.</span>
<span class="co">#&gt; Wind speed has been added to the Variables table.</span>
<span class="co">#&gt; Wind gust speed has been added to the Variables table.</span>
<span class="co">#&gt; Wind direction has been added to the Variables table.</span>
<span class="co">#&gt; Wind speed has been added to the Variables table.</span>
<span class="co">#&gt; Wind gust speed has been added to the Variables table.</span></code></pre></div>
<p>Optional arguments:</p>
<ul>
<li>processing level (otherwise “Raw data”)</li>
<li>actionby - First name of person who performed the action. If they do not exist in the database already, arguments to the <code><a href="../reference/db_describe_person.html">db_describe_person()</a></code> function must also be supplied: PersonLastName and PrimaryEmail.<br>
</li>
<li>equipment - code of the equipment used to collect the data. If not already in database, all required arguments to <code><a href="../reference/db_describe_equipment.html">db_describe_equipment()</a></code> must be supplied (at least serial_no, model_name, vendor, owner_first). If the equipment model is new, the manufacturer must also be supplied. If the owner of the equipment is not already in the people table, owner_last and owner_email must also be supplied.</li>
</ul>
</div>
<div id="get-values" class="section level2">
<h2 class="hasAnchor">
<a href="#get-values" class="anchor"></a>Get values</h2>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> datavalue, res.resultid, var.variablenamecv, units.unitsname, valuedatetime, sf.samplingfeaturecode
<span class="kw">FROM</span> measurementresultvalues mrv
<span class="kw">INNER</span> <span class="kw">JOIN</span> results res <span class="kw">ON</span> mrv.resultid = res.resultid
<span class="kw">INNER</span> <span class="kw">JOIN</span> variables var <span class="kw">ON</span> res.variableid = var.variableid
<span class="kw">INNER</span> <span class="kw">JOIN</span> featureactions fa <span class="kw">ON</span> res.featureactionid = fa.featureactionid
<span class="kw">INNER</span> <span class="kw">JOIN</span> samplingfeatures sf <span class="kw">ON</span> sf.samplingfeatureid = fa.samplingfeatureid
<span class="kw">INNER</span> <span class="kw">JOIN</span> actions acts <span class="kw">ON</span> acts.actionid = fa.actionid
<span class="kw">INNER</span> <span class="kw">JOIN</span> units units <span class="kw">ON</span> units.unitsid = res.unitsid
<span class="kw">INNER</span> <span class="kw">JOIN</span> methods meth <span class="kw">ON</span> meth.methodid = acts.methodid</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">DataValue</th>
<th align="right">ResultID</th>
<th align="left">VariableNameCV</th>
<th align="left">UnitsName</th>
<th align="left">ValueDateTime</th>
<th align="left">SamplingFeatureCode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">180.0</td>
<td align="right">1</td>
<td align="left">Wind direction</td>
<td align="left">Degree</td>
<td align="left">2018-06-27 13:45:00</td>
<td align="left">BB1</td>
</tr>
<tr class="even">
<td align="right">1.0</td>
<td align="right">2</td>
<td align="left">Wind speed</td>
<td align="left">Meter per Second</td>
<td align="left">2018-06-27 13:45:00</td>
<td align="left">BB1</td>
</tr>
<tr class="odd">
<td align="right">2.0</td>
<td align="right">3</td>
<td align="left">Wind gust speed</td>
<td align="left">Meter per Second</td>
<td align="left">2018-06-27 13:45:00</td>
<td align="left">BB1</td>
</tr>
<tr class="even">
<td align="right">170.0</td>
<td align="right">4</td>
<td align="left">Wind direction</td>
<td align="left">Degree</td>
<td align="left">2018-06-27 13:55:00</td>
<td align="left">BB2</td>
</tr>
<tr class="odd">
<td align="right">1.5</td>
<td align="right">5</td>
<td align="left">Wind speed</td>
<td align="left">Meter per Second</td>
<td align="left">2018-06-27 13:55:00</td>
<td align="left">BB2</td>
</tr>
<tr class="even">
<td align="right">2.5</td>
<td align="right">6</td>
<td align="left">Wind gust speed</td>
<td align="left">Meter per Second</td>
<td align="left">2018-06-27 13:55:00</td>
<td align="left">BB2</td>
</tr>
</tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#connect">Connect</a></li>
      <li><a href="#prepare-data">Prepare data</a></li>
      <li><a href="#variables-and-units">Variables and units</a></li>
      <li><a href="#insert">Insert</a></li>
      <li><a href="#get-values">Get values</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kelly Hondula, Nate Jones.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
