<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use an ODM2 Database in R • rodm2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Use an ODM2 Database in R">
<meta property="og:description" content="Organize site, sample, and sensor data with R.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rodm2</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/khondula/rodm2">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="rodm2" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rodm2" class="anchor"></a>rodm2</h1></div>
<p><!-- badges: start --></p>
<p><a href="https://travis-ci.org/khondula/rodm2"><img src="https://travis-ci.org/khondula/rodm2.svg?branch=master" alt="Travis build status"></a> <a href="https://www.repostatus.org/#wip"><img src="https://www.repostatus.org/badges/latest/wip.svg" alt="Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a></p>
<p><!-- badges: end --></p>
<p>Organize site, sample, and sensor data all in one place!</p>
<p>The goal of <strong>rodm2</strong> is to make it easy to use the <a href="https://github.com/ODM2/ODM2">ODM2</a> data model in R, in order to promote collaboration between ecologists, hydrologists, and soil scientists. It is intended to help manage complex field data using a sophisticated relational data model without requiring prior knowledge of advanced database principles.</p>
<blockquote>
<p>How does it work?</p>
</blockquote>
<p>Package functions create parameterized SQL statements to populate and query a flat file (sqlite) database using inputs such as site names, variables, and date ranges. Interactive features (shiny gadgets) are included to facilitate the use of a controlled vocabulary and represent complex hierarchical site and sampling designs within the database structure.</p>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>You can install this package from GitHub with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"khondula/rodm2"</span>)</code></pre></div>
<ul>
<li>Set up or connect to an ODM2 database file on your computer with <code><a href="reference/create_sqlite.html">create_sqlite()</a></code> or <code><a href="reference/connect_sqlite.html">connect_sqlite()</a></code>
</li>
<li>Insert metadata about sites, methods, measured variables using <code>db_describe_%METADATA TYPE%()</code> functions</li>
<li>Optionally, label sites with annotations and describe hierarchical site designs as related features using <code><a href="reference/db_annotate.html">db_annotate()</a></code> and <code><a href="reference/db_add_relations.html">db_add_relations()</a></code>
</li>
<li>Insert data from time series, in situ point or profile measurements, or ex situ data from samples collected in the field using <code>db_insert_results_%RESULT TYPE%()</code>
</li>
<li>Query results based on site, variable, and data type (e.g. time series, samples) using <code><a href="reference/db_get_results.html">db_get_results()</a></code>
</li>
</ul>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h2>
<p>The basic steps of using rodm2 are:</p>
<div id="connect" class="section level3">
<h3 class="hasAnchor">
<a href="#connect" class="anchor"></a>1. Connect</h3>
<p>Load rodm2 and create a connection to your database. If you don’t have an existing database, create an empty ODM2 sqlite database and connection using <code><a href="reference/create_sqlite.html">create_sqlite(connect = TRUE)</a></code> or if you are starting from an existing database use <code><a href="reference/connect_sqlite.html">connect_sqlite()</a></code>. You can view and edit this database using <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> outside of R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rodm2)
db &lt;-<span class="st"> </span>rodm2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rodm2/topics/create_sqlite">create_sqlite</a></span>(<span class="dt">connect =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="describe-metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#describe-metadata" class="anchor"></a>2. Describe metadata</h3>
<p>Add information about sites, methods, measured variables, etc. using <code>db_describe_%TABLE%</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="reference/db_describe_site.html">db_describe_site</a></span>(db, 
                 <span class="dt">site_code =</span> <span class="st">"501R1"</span>, 
                 <span class="dt">sitetypecv =</span> <span class="st">"Site"</span>)
<span class="co">#&gt; Site 501R1 has been entered into the samplingfeatures table.</span>

<span class="kw"><a href="reference/db_describe_method.html">db_describe_method</a></span>(db,
                   <span class="dt">methodname =</span> <span class="st">"Sonic anemometer"</span>, 
                   <span class="dt">methodcode =</span> <span class="st">"SA"</span>, 
                   <span class="dt">methodtypecv =</span> <span class="st">"dataRetrieval"</span>)
<span class="co">#&gt; Sonic anemometer has been added to the Methods table.</span></code></pre></div>
<p>Optionally, use annotations and relationships with <code><a href="reference/db_annotate.html">db_annotate()</a></code> and <code><a href="reference/db_add_relations.html">db_add_relations()</a></code> to label site groups and represent sampling designs.</p>
</div>
<div id="insert-data" class="section level3">
<h3 class="hasAnchor">
<a href="#insert-data" class="anchor"></a>3. Insert data</h3>
<p>Data are uploaded using “insert” functions for specific types of results such as time series, samples, measurements, or a vertical profile. For time series data, the data to upload should have data values for one or more variables collected at one site using the same instrument. It needs at least 2 timepoints, and a “Timestamp column” formatted as YYYY-MM-DD HH:MM:SS. For example:</p>
<table class="table table">
<thead><tr class="header">
<th align="left">Timestamp</th>
<th align="right">wd</th>
<th align="right">ws</th>
<th align="right">gustspeed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-06-27 13:45:00</td>
<td align="right">180</td>
<td align="right">1.0</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td align="left">2018-06-27 13:55:00</td>
<td align="right">170</td>
<td align="right">1.5</td>
<td align="right">2.5</td>
</tr>
</tbody>
</table>
<p>The type of data in each column needs to be described in a “variables list” with terms and units from a controlled vocabulary. Create this list for a dataset using a shiny gadget (opens in the Viewer pane of RStudio) with the function <code><a href="reference/make_vars_list.html">make_vars_list()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars_list &lt;-<span class="st"> </span><span class="kw"><a href="reference/make_vars_list.html">make_vars_list</a></span>(ts_data)</code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/khondula/rodm2/master/man/figures/vars-gadget.png" alt="vars list shiny gadget"><p class="caption">vars list shiny gadget</p>
</div>
<p>Once the <code>vars_list</code> is created, use it in the <code><a href="reference/db_insert_results_ts.html">db_insert_results_ts()</a></code> function to upload data along with its associated metadata</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/db_insert_results_ts.html">db_insert_results_ts</a></span>(db, 
                     <span class="dt">datavalues =</span> ts_data,
                     <span class="dt">methodcode =</span> <span class="st">"SA"</span>,
                     <span class="dt">site_code =</span> <span class="st">"501R1"</span>,
                     <span class="dt">variables =</span> vars_list,
                     <span class="dt">sampledmedium =</span> <span class="st">"air"</span>)
<span class="co">#&gt; Warning: Closing open result set, pending rows</span></code></pre></div>
<p>Data associated with samples taken in the field and a property measured in the lab needs to have at least 4 columns corresponding to Timestamp, Site ID, Sample ID, and data value.</p>
<table class="table table">
<thead><tr class="header">
<th align="left">Timestamp</th>
<th align="left">Site</th>
<th align="left">Sample</th>
<th align="right">DOC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-06-27 13:45:00</td>
<td align="left">501R1</td>
<td align="left">DOC001</td>
<td align="right">10.0</td>
</tr>
<tr class="even">
<td align="left">2018-07-27 13:55:00</td>
<td align="left">501R1</td>
<td align="left">DOC002</td>
<td align="right">12.3</td>
</tr>
</tbody>
</table>
<p>Sample data are inserted with <code><a href="reference/db_insert_results_samples.html">db_insert_results_samples()</a></code> which requires metadata about both the method used to collect samples as well as the method used to analyze the sample. Provide details using <code>db_describe_%METADATA%()</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/db_describe_method.html">db_describe_method</a></span>(db, <span class="dt">methodname =</span> <span class="st">"Shimadzu"</span>, 
                   <span class="dt">methodtypecv =</span> <span class="st">"specimenAnalysis"</span>,
                   <span class="dt">methodcode =</span> <span class="st">"Shimadzu"</span>)
<span class="co">#&gt; Warning: Closing open result set, pending rows</span>
<span class="co">#&gt; Shimadzu has been added to the Methods table.</span>
<span class="kw"><a href="reference/db_describe_method.html">db_describe_method</a></span>(db, <span class="dt">methodname =</span> <span class="st">"Water sample"</span>, 
                   <span class="dt">methodtypecv =</span> <span class="st">"specimenCollection"</span>,
                   <span class="dt">methodcode =</span> <span class="st">"watersamp"</span>)
<span class="co">#&gt; Water sample has been added to the Methods table.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars_list &lt;-<span class="st"> </span><span class="kw"><a href="reference/make_vars_list.html">make_vars_list</a></span>(sample_data[,<span class="dv">4</span>])</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/db_insert_results_samples.html">db_insert_results_samples</a></span>(db, 
                          sample_data, 
                          <span class="dt">field_method =</span> <span class="st">"watersamp"</span>,
                          <span class="dt">lab_method =</span> <span class="st">"Shimadzu"</span>, 
                          <span class="dt">variables =</span> vars_list, 
                          <span class="dt">sampledmedium =</span> <span class="st">"liquidAqueous"</span>)
<span class="co">#&gt; DOC has been added to the Variables table.</span>
<span class="co">#&gt; Sample DOC001 and associated data have been entered.</span>
<span class="co">#&gt; Sample DOC002 and associated data have been entered.</span></code></pre></div>
<p>The insert function assumes that Site IDs are in a column called “Site” and Sample IDs are in a column called “Sample” but you can specify otherwise with the arguments <code>site_code_col</code> and <code>sample_code_col</code>. See more options for specifying metadata in the documentation for <code><a href="reference/db_insert_results_samples.html">db_insert_results_samples()</a></code></p>
</div>
<div id="query" class="section level3">
<h3 class="hasAnchor">
<a href="#query" class="anchor"></a>4. Query</h3>
<p><code><a href="reference/db_get_results.html">db_get_results()</a></code> returns a list of dataframes with each type of result requested. By default retrieves data associated with all site codes and variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_data &lt;-<span class="st"> </span><span class="kw"><a href="reference/db_get_results.html">db_get_results</a></span>(db, <span class="dt">result_type =</span> <span class="kw">c</span>(<span class="st">"ts"</span>, <span class="st">"sample"</span>))
<span class="kw">str</span>(results_data)
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ Time_series_data:'data.frame':    6 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ ValueDateTime      : chr [1:6] "2018-06-27 13:55:00" "2018-06-27 13:45:00" "2018-06-27 13:45:00" "2018-06-27 13:55:00" ...</span>
<span class="co">#&gt;   ..$ DataValue          : num [1:6] 170 180 1 1.5 2 2.5</span>
<span class="co">#&gt;   ..$ UnitsName          : chr [1:6] "Degree" "Degree" "Meter per Second" "Meter per Second" ...</span>
<span class="co">#&gt;   ..$ VariableNameCV     : chr [1:6] "Wind direction" "Wind direction" "Wind speed" "Wind speed" ...</span>
<span class="co">#&gt;   ..$ SamplingFeatureCode: chr [1:6] "501R1" "501R1" "501R1" "501R1" ...</span>
<span class="co">#&gt;   ..$ ProcessingLevelCode: chr [1:6] "Raw data" "Raw data" "Raw data" "Raw data" ...</span>
<span class="co">#&gt;  $ Sample_data     :'data.frame':    2 obs. of  7 variables:</span>
<span class="co">#&gt;   ..$ ValueDateTime      : chr [1:2] "2018-06-27 13:45:00" "2018-07-27 13:55:00"</span>
<span class="co">#&gt;   ..$ DataValue          : num [1:2] 10 12.3</span>
<span class="co">#&gt;   ..$ UnitsName          : chr [1:2] "Milligram per Liter" "Milligram per Liter"</span>
<span class="co">#&gt;   ..$ VariableNameCV     : chr [1:2] "DOC" "DOC"</span>
<span class="co">#&gt;   ..$ SamplingFeatureCode: chr [1:2] "DOC001" "DOC002"</span>
<span class="co">#&gt;   ..$ ProcessingLevelCode: chr [1:2] "Raw data" "Raw data"</span>
<span class="co">#&gt;   ..$ Site               : chr [1:2] "501R1" "501R1"</span>
<span class="co">#&gt;  $ Measurement_data: NULL</span></code></pre></div>
<p>Use list subsetting to get a data frame with time series (ts) results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ts_data &lt;-<span class="st"> </span>results_data[[<span class="st">"Time_series_data"</span>]]
<span class="co"># OR</span>
ts_data &lt;-<span class="st"> </span>results_data<span class="op">$</span>Time_series_data

<span class="kw">head</span>(ts_data)
<span class="co">#&gt;         ValueDateTime DataValue        UnitsName  VariableNameCV</span>
<span class="co">#&gt; 1 2018-06-27 13:55:00     170.0           Degree  Wind direction</span>
<span class="co">#&gt; 2 2018-06-27 13:45:00     180.0           Degree  Wind direction</span>
<span class="co">#&gt; 3 2018-06-27 13:45:00       1.0 Meter per Second      Wind speed</span>
<span class="co">#&gt; 4 2018-06-27 13:55:00       1.5 Meter per Second      Wind speed</span>
<span class="co">#&gt; 5 2018-06-27 13:45:00       2.0 Meter per Second Wind gust speed</span>
<span class="co">#&gt; 6 2018-06-27 13:55:00       2.5 Meter per Second Wind gust speed</span>
<span class="co">#&gt;   SamplingFeatureCode ProcessingLevelCode</span>
<span class="co">#&gt; 1               501R1            Raw data</span>
<span class="co">#&gt; 2               501R1            Raw data</span>
<span class="co">#&gt; 3               501R1            Raw data</span>
<span class="co">#&gt; 4               501R1            Raw data</span>
<span class="co">#&gt; 5               501R1            Raw data</span>
<span class="co">#&gt; 6               501R1            Raw data</span></code></pre></div>
</div>
</div>
<div id="more-details" class="section level2">
<h2 class="hasAnchor">
<a href="#more-details" class="anchor"></a>More details</h2>
<p><code>rodm2</code> is being designed to work either with an existing ODM2 database on a server (e.g. PostgreSQL), or with spreadsheet files that aren’t (yet!) in a relational database. This package is intended to help populate, query, and visualize data that is organized with the ODM2 structure. It should not be necessary to understand ODM2 or SQL but it may help! See <a href="http://odm2.github.io/ODM2/schemas/ODM2_Current/diagrams/ODM2OverviewSimplified.html">here</a> for an overview of the data structure.</p>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>This project is made possible through support from <a href="https://ropensci.org/">rOpenSci</a> and <a href="https://www.sesync.org/">SESYNC</a>.</p>
<p>Read about the details and development of ODM2 in the open access paper in Environmental Modelling &amp; Software:</p>
<blockquote>
<p>Horsburgh, J. S., Aufdenkampe, A. K., Mayorga, E., Lehnert, K. A., Hsu, L., Song, L., Spackman Jones, A., Damiano, S. G., Tarboton, D. G., Valentine, D., Zaslavsky, I., Whitenack, T. (2016). <a href="http://dx.doi.org/10.1016/j.envsoft.2016.01.010">Observations Data Model 2: A community information model for spatially discrete Earth observations</a>, Environmental Modelling &amp; Software, 79, 55-74, <a href="http://dx.doi.org/10.1016/j.envsoft.2016.01.010" class="uri">http://dx.doi.org/10.1016/j.envsoft.2016.01.010</a></p>
</blockquote>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/khondula/rodm2">https://​github.com/​khondula/​rodm2</a>
</li>
<li>Report a bug at <br><a href="https://github.com/khondula/rodm2/issues">https://​github.com/​khondula/​rodm2/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Kelly Hondula <br><small class="roles"> Author, maintainer </small>  </li>
<li>Nate Jones <br><small class="roles"> Author </small>  </li>
</ul>
</div>


      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kelly Hondula, Nate Jones.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
