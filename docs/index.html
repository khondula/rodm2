<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use an ODM2 Database in R • rodm2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Use an ODM2 Database in R">
<meta property="og:description" content="Organize site, sample, and sensor data with R.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rodm2</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/insert-measurements.html">Insert measurement results</a>
    </li>
    <li>
      <a href="articles/introduction.html">Insert time series results</a>
    </li>
    <li>
      <a href="articles/new_person.html">Link Actions to People</a>
    </li>
    <li>
      <a href="articles/newsites.html">Add new sites</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="rodm2" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rodm2" class="anchor"></a>rodm2</h1></div>
<p>The goal of <strong>rodm2</strong> is to make it easy to use the <a href="https://github.com/ODM2/ODM2">ODM2</a> data model in R, in order to promote collaboration between ecologists, hydrologists, and soil scientists.</p>
<p>Organize site, sample, and sensor data all in one place! For example:</p>
<ul>
<li>time series hydrologic observations from a well or stream gage</li>
<li>sediment sample properties from a soil core analyzed in a lab</li>
<li>categorical observations manually recorded in the field</li>
</ul>
<p>This project is just getting started! Get in touch or open an <a href="https://github.com/khondula/rodm2/issues">issue</a> if you have a use case or if you’re interested in collaborating.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install this package from GitHub with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"khondula/rodm2"</span>)</code></pre></div>
</div>
<div id="usage-example" class="section level2">
<h2 class="hasAnchor">
<a href="#usage-example" class="anchor"></a>Usage Example</h2>
<p>Organize a dataframe of time series values into a new or existing ODM2 sqlite database:</p>
<p>The data to upload should have time series data for one or more variables collected at one site using the same instrument. It needs at least 2 timepoints, and a “Timestamp column” formatted as YYYY-MM-DD HH:MM:SS. For example:</p>
<table class="table table">
<thead><tr class="header">
<th align="left">Timestamp</th>
<th align="right">wd</th>
<th align="right">ws</th>
<th align="right">gustspeed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-06-27 13:45:00</td>
<td align="right">180</td>
<td align="right">1.0</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td align="left">2018-06-27 13:55:00</td>
<td align="right">170</td>
<td align="right">1.5</td>
<td align="right">2.5</td>
</tr>
</tbody>
</table>
<p>Load up the package and create a new ODM2 database or connection object to an existing ODM2 database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rodm2)
dblite &lt;-<span class="st"> </span><span class="kw"><a href="reference/create_sqlite.html">create_sqlite</a></span>(<span class="dt">connect =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Each column in the data to upload should contain data about one variable with the same units. Create a list that specifies for each variable the column names and units:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="st">'Wind direction'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'wd'</span>, <span class="dt">units =</span> <span class="st">'Degree'</span>),
  <span class="st">'Wind speed'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'ws'</span>, <span class="dt">units =</span> <span class="st">'Meter per Second'</span>),
  <span class="st">'Wind gust speed'</span> =<span class="st"> </span><span class="kw">list</span>(<span class="dt">column =</span> <span class="st">'gustspeed'</span>, <span class="dt">units =</span> <span class="st">'Meter per Second'</span>)
)</code></pre></div>
<p>If there are columns in the data that correspond to censor codes or data quality codes, also supply those column names as ‘qualitycodecol’ and/or ‘censorcodecol’ in the list for each variable.</p>
<p>Supply database connection object, new data, method, site, variables, and sampled medium to insert time series data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/db_insert_results_ts.html">db_insert_results_ts</a></span>(<span class="dt">db =</span> dblite, <span class="co"># database connection</span>
                     <span class="dt">datavalues =</span> ts_data, <span class="co"># dataframe with Timestamp column</span>
                     <span class="dt">method =</span> <span class="st">"SonicAnemometer"</span>, 
                     <span class="dt">site_code =</span> <span class="st">"Site1"</span>, 
                     <span class="dt">variables =</span> vars_list, 
                     <span class="dt">sampledmedium =</span> <span class="st">"Air"</span>
                     )
<span class="co">#&gt; SonicAnemometer has been added to the Methods table.</span>
<span class="co">#&gt; Wind direction has been added to the Variables table.</span>
<span class="co">#&gt; Wind speed has been added to the Variables table.</span>
<span class="co">#&gt; Wind gust speed has been added to the Variables table.</span>
<span class="co">#&gt; Site Site1 has been entered into the samplingfeatures table.</span></code></pre></div>
<p>You can also specify who collected the data with <code>actionby</code> and a specific piece of equipment used with <code>equip_name</code>. Methods, variables, and site codes not already existing in the database will be added to the appropriate tables.</p>
</div>
<div id="more-details" class="section level2">
<h2 class="hasAnchor">
<a href="#more-details" class="anchor"></a>More details</h2>
<p><code>rodm2</code> is designed to work either with an existing ODM2 database on a server (e.g. PostgreSQL), or with spreadsheet files that aren’t (yet!) in a relational database. This package is intended to help populate, query, and visualize data that is organized with the ODM2 structure. It should not be necessary to understand ODM2 or SQL but it may help! See <a href="http://odm2.github.io/ODM2/schemas/ODM2_Current/diagrams/ODM2OverviewSimplified.html">here</a> for an overview of the data structure.</p>
<p><strong>With a PostgreSQL database</strong></p>
<p>A script for creating a PostgreSQL database with the ODM2 schema is <a href="https://github.com/ODM2/ODM2/blob/master/src/blank_schema_scripts/postgresql/ODM2_for_PostgreSQL.sql">here</a> and instructions for populating the controlled vocabularies tables using a script are <a href="https://github.com/ODM2/ODM2/tree/master/src/load_cvs">here</a>.</p>
<p>You will need to create a database connection object, eg. using <code><a href="http://www.rdocumentation.org/packages/DBI/topics/dbConnect">DBI::dbConnect()</a></code> and your host and log-in credentials.</p>
<p><strong>Without an external database</strong></p>
<p>Initialize an empty sqlite database with odm2 schema in your working directory (empty except for the controlled vocabulary tables). You can view and edit this database using <a href="https://sqlitebrowser.org/">DB Browser for SQLite</a> outside of R. By default, <code><a href="reference/create_sqlite.html">create_sqlite()</a></code> just creates the sqlite file but <code>connect = TRUE</code> will return the connection object as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rodm2)
dblite &lt;-<span class="st"> </span><span class="kw"><a href="reference/create_sqlite.html">create_sqlite</a></span>(<span class="dt">connect =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Or create a connection to an existing sqlite file using <code>dbConnect</code> and the name of the file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dblite &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbConnect">dbConnect</a></span>(RSQLite<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/RSQLite/topics/SQLite">SQLite</a></span>(), <span class="st">"odm2.sqlite"</span>)</code></pre></div>
<p>There are 132 tables in the database. The “blank” database has the Units table populated as well as all of the controlled vocabularies.</p>
<p>See the terms for a given controlled vocabulary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rodm2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rodm2/topics/get_cv_terms">get_cv_terms</a></span>(<span class="st">"methodtype"</span>)
<span class="co">#&gt; methodtype controlled vocabulary terms: "Cruise", "Data retrieval", "Derivation", "Equipment deployment", "Equipment maintenance", "Equipment programming", "Equipment retrieval", "Estimation", "Expedition", "Field activity", "Generic non-observation", "Instrument Continuing Calibration Verification", "Instrument calibration", "Instrument deployment", "Instrument retrieval", "Observation", "Simulation", "Site visit", "Specimen analysis", "Specimen collection", "Specimen fractionation", "Specimen preparation", "Specimen preservation", "Submersible launch", "Unknown")</span></code></pre></div>
<p>Explore the database structure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbListTables">dbListTables</a></span>(dblite))
<span class="co">#&gt; [1] "ActionAnnotations"             "ActionBy"                     </span>
<span class="co">#&gt; [3] "ActionDirectives"              "ActionExtensionPropertyValues"</span>
<span class="co">#&gt; [5] "Actions"                       "Affiliations"</span>
DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbListFields">dbListFields</a></span>(dblite, <span class="st">"featureactions"</span>)
<span class="co">#&gt; [1] "FeatureActionID"   "SamplingFeatureID" "ActionID"</span>
<span class="kw">head</span>(DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbReadTable">dbReadTable</a></span>(dblite, <span class="st">"units"</span>))
<span class="co">#&gt;   UnitsID           UnitsTypeCV UnitsAbbreviation       UnitsName</span>
<span class="co">#&gt; 1       1         Absorbed dose                Gy            Gray</span>
<span class="co">#&gt; 2       2         Absorbed dose               rad             RAD</span>
<span class="co">#&gt; 3       3    Absorbed dose rate              Gy/s Gray per Second</span>
<span class="co">#&gt; 4       4 Amount of Information               ban             Ban</span>
<span class="co">#&gt; 5       5 Amount of Information               bit             Bit</span>
<span class="co">#&gt; 6       6 Amount of Information                By            Byte</span>
<span class="co">#&gt;   UnitsLink</span>
<span class="co">#&gt; 1      &lt;NA&gt;</span>
<span class="co">#&gt; 2      &lt;NA&gt;</span>
<span class="co">#&gt; 3      &lt;NA&gt;</span>
<span class="co">#&gt; 4      &lt;NA&gt;</span>
<span class="co">#&gt; 5      &lt;NA&gt;</span>
<span class="co">#&gt; 6      &lt;NA&gt;</span></code></pre></div>
</div>
<div id="describe-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#describe-functions" class="anchor"></a>“Describe” functions</h2>
<p>Add information using <code>db_describe_%TABLE%</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rodm2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rodm2/topics/db_describe_person">db_describe_person</a></span>(<span class="dt">db =</span> dblite, <span class="dt">PersonFirstName =</span> <span class="st">"Wendy"</span>,
     <span class="dt">PersonLastName =</span> <span class="st">"Wetland"</span>,
     <span class="dt">AffiliationStartDate =</span> <span class="st">"2018-01-01"</span>,
     <span class="dt">PrimaryEmail =</span> <span class="st">"wendy 'at' swamps.edu"</span>)
<span class="co">#&gt; Wendy Wetland has been entered into the People table.</span></code></pre></div>
<p>There are currently “describe” functions for:</p>
<ul>
<li>methods</li>
<li>people</li>
<li>variables</li>
<li>annotations</li>
<li>organizations (necessary for equipment)</li>
<li>sites</li>
<li>site geometries</li>
</ul>
</div>
<div id="insert-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#insert-functions" class="anchor"></a>‘Insert’ functions</h2>
<p>Data are uploaded using “insert” functions for specific types of results, eg. <code><a href="reference/db_insert_results_ts.html">db_insert_results_ts()</a></code> for a data frame of time series results.</p>
<ul>
<li>time_series: time series data collected at a site using a sensor</li>
</ul>
<p>In progress:</p>
<ul>
<li>measurement: in-situ point measurement (numeric) taken at a site</li>
<li>category: in-situ point measurement (text/categorical) taken at a site</li>
<li>sample_measurement: ex-situ measurement (numeric) of a sample taken at a site</li>
</ul>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>This project is made possible through support from <a href="https://ropensci.org/">rOpenSci</a> and <a href="https://www.sesync.org/">SESYNC</a>.</p>
<p>Read about the details and development of ODM2 in the open access paper in Environmental Modelling &amp; Software:</p>
<blockquote>
<p>Horsburgh, J. S., Aufdenkampe, A. K., Mayorga, E., Lehnert, K. A., Hsu, L., Song, L., Spackman Jones, A., Damiano, S. G., Tarboton, D. G., Valentine, D., Zaslavsky, I., Whitenack, T. (2016). <a href="http://dx.doi.org/10.1016/j.envsoft.2016.01.010">Observations Data Model 2: A community information model for spatially discrete Earth observations</a>, Environmental Modelling &amp; Software, 79, 55-74, <a href="http://dx.doi.org/10.1016/j.envsoft.2016.01.010" class="uri">http://dx.doi.org/10.1016/j.envsoft.2016.01.010</a></p>
</blockquote>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Report a bug at <br><a href="NA">NA</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Kelly Hondula <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kelly Hondula.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
